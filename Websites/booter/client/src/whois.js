import React, { Component } from 'react';
import { withStyles } from '@material-ui/core/styles';
import Paper from '@material-ui/core/Paper';
import Typography from '@material-ui/core/Typography';
import Breadcrumbs from '@material-ui/core/Breadcrumbs';
import Divider from '@material-ui/core/Divider';
import TextField from '@material-ui/core/TextField';
import Button from '@material-ui/core/Button';
import SearchIcon from '@material-ui/icons/Search';
import Settings from './settings.json';
import MapView from './Map';
import 'whatwg-fetch';

const useStyles = (theme) => ({
	root: {
	    display: 'flex',
	    flexWrap: 'wrap',
	},
	PaperX1: {
		margin: theme.spacing(1),
		width: theme.spacing(50),
		height: theme.spacing(30),
	},
	PaperX2: {
		margin: theme.spacing(1),
		width: theme.spacing(120),
		height: '100%',
		padding: theme.spacing(1, 2, 3)
	},
});

class WhoSearch extends Component {

	constructor(props)
	{
		super(props);
		this.state = {
			HostnameTarget : '',
			ScanResult : false,
			ipv4 : '',
			iptype : '',
			ipfamily : '',
			isp : '',
			organization : '',
			country : '',
			region : '',
			district : '',
			city : '',
			timezone : '',
			coords : ''
		}
	}

	HandleChange = (event) => {
		this.setState({
			HostnameTarget : event.target.value
		});
	}
	HandleSubmit = (event) => {
		const {
			HostnameTarget
		} = this.state;
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/tools/whois', {
			method : 'POST',
			headers : {
				'Content-Type': 'application/json'
			},
			body : JSON.stringify({
				Token : token,
				HostnameTarget : HostnameTarget
			})
		})
		.then(res => res.json())
		.then(json => {
			if(json.success)
			{
				this.setState({
					ScanResult : true,
					ipv4 : json.ipv4,
					iptype : json.iptype,
					ipfamily : json.ipfamily,
					isp : json.isp,
					organization : json.organization,
					country : json.country,
					region : json.region,
					district : json.district,
					city : json.city,
					timezone : json.timezone,
					coords : json.coords
				});
			}
		})
	}
	render () {
		const {
			HostnameTarget,
			ScanResult,
			ipv4,
			iptype,
			ipfamily,
			isp,
			organization,
			country,
			region,
			district,
			city,
			timezone,
			coords
		} = this.state;
		const { classes }  = this.props;
		return (
			<div>
				<div 
					style={{ 
						marginBottom: '1rem'
					}}
				>
					<Breadcrumbs aria-label="breadcrumb">
						<Typography color="inherit">Home</Typography>
						<Typography color="inherit">Tools</Typography>
						<Typography color="textPrimary">GeoIP Lookup</Typography>
					</Breadcrumbs>
				</div>
				<Divider />
				<div 
					className={classes.root} 	
					style={{ 
						marginTop: '1rem',
						marginBottom: '1rem'
					}}
				>
					<Paper
						className={classes.PaperX1}
						style={{
							padding: '1rem',
						}}
					>
						<div
							style={{
								marginBottom: '1rem',
								textAlign: 'center'
							}}
						>
							<Typography variant="h6" gutterBottom>
								Input
							</Typography>
							<div
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<TextField 
									label="Hostname" 
									variant="filled"
									value={HostnameTarget}
									onChange={this.HandleChange}
									helperText="Example : google.com"
									style={{
										width: '100%'
									}}
								/>
							</div>
							<div	
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<Button
									variant="contained"
									endIcon={<SearchIcon />}
									style={{
										width: '100%'
									}}
									onClick={this.HandleSubmit}
								>
									Scan
								</Button>
							</div>
						</div>
					</Paper>
					{
						ScanResult ? 
						(
							<Paper
								className={classes.PaperX2}
								style={{
									padding: '1rem'
								}}
							>
								<div
									style={{
										marginBottom: '1rem'
									}}
								>
									<Typography variant="h6" gutterBottom>
										Result
									</Typography>
								</div>
								<div>
									<Typography variant="subtitle1" gutterBottom>
										IP Address : {ipv4}
							      	</Typography>
									<Typography variant="subtitle1" gutterBottom>
										Address Type : {iptype}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Family : {ipfamily}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										ISP : {isp}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Organization : {organization}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Country : {country}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Region : {region}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										District : {district}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										City : {city}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Timezone : {timezone}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Coordinates : {coords}
							      	</Typography>
								</div>
								<div>
									<MapView 
										lan={coords.split(',')[0]}
										lng={coords.split(', ')[1]}
									/>
								</div>	
							</Paper>
						) : null
					}
				</div>
			</div>
		)
	};
}

export default withStyles(useStyles)(WhoSearch);