import React, { Component } from 'react';
import 'whatwg-fetch';
import { getFromStorage, setInStorage } from './storage';
import { Redirect } from 'react-router-dom';
import { withStyles } from '@material-ui/core/styles';
import Button from '@material-ui/core/Button';
import Typography from '@material-ui/core/Typography';
import AppBar from '@material-ui/core/AppBar';
import Toolbar from '@material-ui/core/Toolbar';
import IconButton from '@material-ui/core/IconButton';
import MenuIcon from '@material-ui/icons/Menu';
import List from '@material-ui/core/List';
import ListItem from '@material-ui/core/ListItem';
import ListItemText from '@material-ui/core/ListItemText';
import ListItemIcon from '@material-ui/core/ListItemIcon';
import ExpandLess from '@material-ui/icons/ExpandLess';
import ExpandMore from '@material-ui/icons/ExpandMore';
import Collapse from '@material-ui/core/Collapse';
import Paper from '@material-ui/core/Paper';
import Drawer from '@material-ui/core/Drawer';
import DashboardIcon from '@material-ui/icons/Dashboard';
import TrackChangesIcon from '@material-ui/icons/TrackChanges';
import DnsIcon from '@material-ui/icons/Dns';
import MapIcon from '@material-ui/icons/Map';
import BuildIcon from '@material-ui/icons/Build';
import PermScanWifiIcon from '@material-ui/icons/PermScanWifi';
import SportsEsportsIcon from '@material-ui/icons/SportsEsports';
import PaymentIcon from '@material-ui/icons/Payment';
import SettingsIcon from '@material-ui/icons/Settings';
import DescriptionIcon from '@material-ui/icons/Description';
import WebAssetIcon from '@material-ui/icons/WebAsset';
import LocalHospitalIcon from '@material-ui/icons/LocalHospital';
import SettingsInputComponentIcon from '@material-ui/icons/SettingsInputComponent';
import Dashboard from './dashboard';
import Attackhub from './atkhub';
import MethodLayer7 from './methodl7';
import ManageServer from './servers';
import WhoSearch from './whois';
import Portscan from './portscan';
import GameServerQuery from './gameserver';
import UpOrDown from './isitup';
import Backdrop from '@material-ui/core/Backdrop';
import CircularProgress from '@material-ui/core/CircularProgress';
import Settings from './settings.json';
import UserPanel from './setpanel';
import ConfirmationNumberIcon from '@material-ui/icons/ConfirmationNumber';
import SupportPanel from './support';
import MonetizationOnIcon from '@material-ui/icons/MonetizationOn';
import ShoppingCartIcon from '@material-ui/icons/ShoppingCart';
import Store from './shop';
import Deposit from './deposit';
import FolderIcon from '@material-ui/icons/Folder';
import BugReportIcon from '@material-ui/icons/BugReport';
import VisibilityIcon from '@material-ui/icons/Visibility';
import Dirbuster from './Dirbuster';
import NMAP from './nmap';

import './scrollbar.css';

const drawerWidth = 280;

const useStyles = (theme) => ({
	root: {
		flexGrow: 1,
		display: 'flex'
	},
	root2: {
		width: drawerWidth,
		height: "100%",
	},
	title: {
		flexGrow: 1,
	},
	nested: {
		paddingLeft: theme.spacing(4),
	},
	PaperShit: {
		maxWidth: '100%'
	},
	menuButton: {
		marginRight: theme.spacing(2),
	},
	backdrop: {
		zIndex: theme.zIndex.drawer + 1,
		color: '#fff',
	},
	drawer: {
		width: drawerWidth,
		[theme.breakpoints.up('lg')]: {
			marginTop: 64,
			height: 'calc(100% - 64px)'
		}
	},
	appBar: {
    	zIndex: theme.zIndex.drawer + 1,
    	backgroundColor : '#424242',
	},
	content: {
	    flexGrow: 1,
	    padding: theme.spacing(3),
	    maxWidth: '100%',
	},
	mobileDrawer : {
		width : '100%'
	},
});

class home extends Component {
	constructor(props)
	{
		super(props)
		this.state = {
			isLoading : true,
			userName : '',
			token : '',
			redirect : false,
			ServNumber : 0,
			OpenWin : false,
			OpenWin2 : false,
			OpenWin3 : false,
			OpenWin4 : false,
			OpenWin5 : false,
			signUpDate : '',
			MoneyBal : 0,
			active: 'FIRST',
			MethodNumber : 0,
			AtkSent : 0,
			Atklogs : [],
			email : ''
		}
		this.HandleLogout = this.HandleLogout.bind(this);
	}

	componentDidMount() {
		const obj = getFromStorage('the_main_app');
		const obj2 = getFromStorage('the_page_app');

		if(obj && obj.token)
		{
			const { token } = obj;

			fetch(Settings.BACKEND_SERVER + 'app/api/verify?token=' + token)
			.then(res => res.json())
			.then(json => {
				if(json.success)
				{
					var booleanPage = false;
					if(obj2 && obj2.page)
					{
						booleanPage = true;
					}
					else
					{
						booleanPage = false;
					}
					this.setState({
						token,
						isLoading : false,
						userName : json.userName,
						ServNumber : json.ServNumber,
						signUpDate : json.signUpDate.split('T')[0],
						MoneyBal : json.MoneyBal,
						MethodNumber : json.MethodLength,
						AtkSent : json.AtkSent,
						Atklogs : json.Atklogs,
						active : booleanPage ? obj2.page : 'FIRST',
						email : json.email
					});
				}
				else
				{
					this.setState({
						isLoading : false,
						redirect : true
					});
				}
			})
		}
		else
		{
			this.setState({
				isLoading : false,
				active: 'FIRST',
				redirect: true
			});
		}
	}

	HandleOpen = () => {
		const {
			OpenWin
		} = this.state;
		this.setState({
			OpenWin : !OpenWin
		});
	}

	HandleOpen2 = () => {
		const {
			OpenWin2
		} = this.state;
		this.setState({
			OpenWin2 : !OpenWin2
		});
	}

	HandleOpen3 = () => {
		const {
			OpenWin3
		} = this.state;
		this.setState({
			OpenWin3 : !OpenWin3
		});
	}

	HandleOpen4 = () => {
		const {
			OpenWin4
		} = this.state;
		this.setState({
			OpenWin4 : !OpenWin4
		});
	}

	HandleOpen5 = () => {
		const {
			OpenWin5
		} = this.state;
		this.setState({
			OpenWin5 : !OpenWin5
		});
	}


	HandleSwitch = () => {
		this.setState({
			active: 'FIRST',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'FIRST' } );
	}

	HandleSwitch2 = () => {
		this.setState({
			active: 'SECOND',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'SECOND' } );
	}

	HandleSwitch3 = () => {
		this.setState({
			active: 'THIRD',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'THIRD' } );
	}

	HandleSwitch4 = () => {
		this.setState({
			active: 'FOURTH',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'FOURTH' } );
	}

	HandleSwitch5 = () => {
		this.setState({
			active: 'FIFTH',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'FIFTH' } );
	}

	HandleSwitch6 = () => {
		this.setState({
			active: 'SIXTH',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'SIXTH' } );
	}

	HandleSwitch7 = () => {
		this.setState({
			active: 'SEVENTH',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'SEVENTH' } );
	}

	HandleSwitch8 = () => {
		this.setState({
			active: 'EIGHT',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'EIGHT' } );
	}

	HandleSwitchSupport = () => {
		this.setState({
			active: 'SUPPORT',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'SUPPORT' } );
	}

	HandleSwitchSettings = () => {
		this.setState({
			active: 'SETTINGS',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'SETTINGS' } );
	}

	HandleSwitchStore = () => {
		this.setState({
			active: 'STORE',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'STORE' } );
	}

	HandleSwitchDeposit = () => {
		this.setState({
			active: 'DEPOSIT',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'DEPOSIT' } );
	}

	HandleSwitchDirbuster = () => {
		this.setState({
			active: 'DIRBUSTER',
			OpenWin2: false
		});
		setInStorage('the_page_app', { page : 'DIRBUSTER' } );
	}

	HandleSwitchNmap = () => {
		this.setState({
			active: 'NMAP',
			OpenWin2: false
		})
		setInStorage('the_page_app', { page : 'NMAP' } )
	}

	HandleLogout = () => {
		this.setState({
			isLoading : true
		});
		const obj = getFromStorage('the_main_app');
		if(obj && obj.token)
		{
			const { token } = obj;
			fetch(Settings.BACKEND_SERVER + 'app/api/logout?token=' + token)
			.then(res => res.json())
			.then(json => {
				if(json.success)
				{
					this.setState({
						token : '',
						isLoading : false,
						redirect : false
					})
					setInStorage('the_main_app', { token : '' } );
				}
				else
				{
					this.setState({
						isLoading : false
					})
				}
				console.log(json.message);
			})
		}
		else
		{
			this.setState({
				isLoading : false
			})
		}
	}
	render () 
		{	
			const { classes }  = this.props;

			const {
				isLoading,
				token,
				redirect,
				userName,
				ServNumber,
				OpenWin,
				OpenWin2,
				OpenWin3,
				OpenWin4,
				signUpDate,
				MoneyBal,
				active,
				MethodNumber,
				AtkSent,
				Atklogs,
				OpenWin5,
				email
			} = this.state;

			const isDesktop = window.innerWidth > 767;

			if(redirect)
			{
				return <Redirect to='/login' />
			}
			else {
				return (
					<div className={classes.root}>
						{
							isLoading ? (
									<div>
										<Backdrop className={classes.backdrop} open={isLoading}>
											<CircularProgress color="inherit" />
										</Backdrop>
									</div>
							) : null
						}
				    <AppBar position="fixed" className={classes.appBar}>
							<Toolbar>
								{ !isDesktop ? (
									<IconButton onClick={this.HandleOpen2} edge="start" className={classes.menuButton} color="inherit" aria-label="menu">
									 <MenuIcon />
									</IconButton>
								) : null}
							<Typography variant="h6" className={classes.title}>
								EXPLOITME.CC
							</Typography>
								<Button color="inherit" onClick={this.HandleLogout}>Logout</Button>
							</Toolbar>
					</AppBar>
		      	    <Drawer
			            anchor='left'
			            open={isDesktop ? true : OpenWin2}
			            onClose={isDesktop ? null : this.HandleOpen2}
    					onOpen={isDesktop ? null : OpenWin2}
    					variant={isDesktop ? 'permanent' : 'temporary'}
    					className={ isDesktop ? classes.drawer : classes.mobileDrawer}
			        >
			        	{
			        		isDesktop ? (
			        			<Toolbar />
			        		) : null
			        	}
			        	<div
			        		className="scrollbar scrollbar-secondary"
			        	>
						    <List
						      component="nav"
						      className={classes.root2}
						    >
							    <ListItem button onClick={this.HandleSwitch}>
								    <ListItemIcon>
								    	<DashboardIcon />
								    </ListItemIcon>
							    	<ListItemText primary="Dashboard" />
							    </ListItem>
							    <ListItem button onClick={this.HandleSwitchStore}>
								    <ListItemIcon>
								    	<ShoppingCartIcon />
								    </ListItemIcon>
							    	<ListItemText primary="Store" />
							    </ListItem>
							    <ListItem button onClick={this.HandleOpen4}>
							    	<ListItemIcon>
							    		<TrackChangesIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Exploitation Hub" />
							    	{OpenWin4 ? <ExpandLess /> : <ExpandMore />}
							    </ListItem>
							    <Collapse in={OpenWin4} timeout="auto" unmountOnExit>
							        <List component="div" disablePadding>
							          <ListItem button disabled className={classes.nested}>
							         	<ListItemIcon>
							          		<SettingsInputComponentIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Layer 4" />
							          </ListItem>
							          <ListItem button onClick={this.HandleSwitch2} className={classes.nested}>
							         	<ListItemIcon>
							          		<WebAssetIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Layer 7" />
							          </ListItem>
							          <ListItem button onClick={this.HandleSwitchDirbuster} className={classes.nested}>
							         	<ListItemIcon>
							          		<FolderIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Dirbuster" />
							          </ListItem>
							          <ListItem button onClick={this.HandleSwitchNmap} className={classes.nested}>
							         	<ListItemIcon>
							          		<VisibilityIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Network Mapper" />
							          </ListItem>
							          <ListItem button disabled className={classes.nested}>
							         	<ListItemIcon>
							          		<BugReportIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Meterpeter" />
							          </ListItem>
							        </List>
						      </Collapse>
							    <ListItem button onClick={this.HandleOpen3}>
							    	<ListItemIcon>
							    		<DescriptionIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Manage Methods" />
							    	{OpenWin3 ? <ExpandLess /> : <ExpandMore />}
							    </ListItem>
							    <Collapse in={OpenWin3} timeout="auto" unmountOnExit>
							        <List component="div" disablePadding>
							          <ListItem button disabled className={classes.nested}>
							         	<ListItemIcon>
							          		<SettingsInputComponentIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Layer 4" />
							          </ListItem>
							          <ListItem button onClick={this.HandleSwitch3} className={classes.nested}>
							         	<ListItemIcon>
							          		<WebAssetIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Layer 7" />
							          </ListItem>
							        </List>
						      </Collapse>
							    <ListItem button onClick={this.HandleSwitch4}>
							    	<ListItemIcon>
							    		<DnsIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Manage Servers" />
							    </ListItem>
							    <ListItem button onClick={this.HandleOpen}>
							    	<ListItemIcon>
							    		<BuildIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Tools" />
							    	{OpenWin ? <ExpandLess /> : <ExpandMore />}
							    </ListItem>
							    <Collapse in={OpenWin} timeout="auto" unmountOnExit>
							        <List component="div" disablePadding>
							          <ListItem button onClick={this.HandleSwitch5} className={classes.nested}>
							         	<ListItemIcon>
							          		<MapIcon />
							          	</ListItemIcon>
							            <ListItemText primary="GeoIP lookup" />
							          </ListItem>
							          <ListItem button onClick={this.HandleSwitch6} className={classes.nested}>
							          	<ListItemIcon>
							          		<PermScanWifiIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Portscan" />
							          </ListItem>
							       	  <ListItem button onClick={this.HandleSwitch7} className={classes.nested}>
							       	  	<ListItemIcon>
							       	  		<SportsEsportsIcon />
							       	  	</ListItemIcon>
							            <ListItemText primary="Game Server Query" />
							          </ListItem>
							          <ListItem button onClick={this.HandleSwitch8} className={classes.nested}>
							       	  	<ListItemIcon>
							       	  		<LocalHospitalIcon />
							       	  	</ListItemIcon>
							            <ListItemText primary="Is it up?" />
							          </ListItem>
							        </List>
						      </Collapse>
							    <ListItem button onClick={this.HandleOpen5}>
							    	<ListItemIcon>
							    		<PaymentIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Billing" />
							    	{OpenWin5 ? <ExpandLess /> : <ExpandMore />}
							    </ListItem>
							    <Collapse in={OpenWin5} timeout="auto" unmountOnExit>
							        <List component="div" disablePadding>
							          <ListItem button onClick={this.HandleSwitchDeposit} className={classes.nested}>
							         	<ListItemIcon>
							          		<MonetizationOnIcon />
							          	</ListItemIcon>
							            <ListItemText primary="Deposit" />
							          </ListItem>
							        </List>
						      </Collapse>
							    <ListItem button onClick={this.HandleSwitchSupport}>
							    	<ListItemIcon>
							    		<ConfirmationNumberIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Support" />
							    </ListItem>
							    <ListItem button onClick={this.HandleSwitchSettings}>
							    	<ListItemIcon>
							    		<SettingsIcon />
							    	</ListItemIcon>
							    	<ListItemText primary="Settings" />
							    </ListItem>
						    </List>
					    </div>
					</Drawer>
						<main
							className={classes.content}
						>
							<Toolbar />
						    <div className={classes.PaperShit}>
							    <Paper 
							    	elevation={3}
							    	style={{
							    		height: '100%',
							    		width: '100%',
							    		padding: '1rem',
							    		maxWidth: '100%'
							    	}}
							    >
				                    { active === 'SECOND' ? (
					                	<Attackhub
					                		name={userName}
					                		token={token}
					                		Atklogs={Atklogs}
					                	/>
					                ) :
					                active === 'THIRD' ? 
					                (
										<MethodLayer7 
											token={token}
										/>
					                ) :
					                active === 'FOURTH' ?
					                (
					                	<ManageServer 
					                		token={token}
					                	/>
					                ) :
					                active === 'FIFTH' ?
					                (
					                	<WhoSearch 
					                		token={token}
					                	/>
					                ) :
					                active === 'SIXTH' ?
					                (
					                	<Portscan
					                		token={token}
					                	/>
					                ) :
					                active === 'SEVENTH' ?
					                (
					                	<GameServerQuery
					                		token={token}
					                	/>
					                ) :
					                active === 'EIGHT' ?
					                (
					                	<UpOrDown 
					                		token={token}
					                	/>
					                ) :
					                active === 'SUPPORT' ?
					                (
					                	<SupportPanel
					                		token={token}
					                	/>
					                ) :
					                active === 'SETTINGS' ?
					                (
					                	<UserPanel
					                		token={token}
					                	/>
					                ) :
					                active === 'STORE' ?
					                (
					                	<Store
					                		token={token}
					                	/>
					                ) :
					                active === 'DIRBUSTER' ?
					                (
					                	<Dirbuster
					                		token={token}
					                	/>
					                ) : 
					                active === 'DEPOSIT' ?
					                (
					                	<Deposit
					                		token={token}
					                	/>
					                ) :
					                active === 'NMAP' ?
					                (
					                	<NMAP
					                		token={token}
					                	/>
					               	) :
										<Dashboard 
											name={userName.charAt(0).toUpperCase() + userName.substring(1)} 
											serverNumber={ServNumber}
											MoneyBal={MoneyBal}
											methodcount={MethodNumber}
											atkcount={AtkSent}
											dateof={signUpDate}
											email={email}
										/> 
					           		}

								</Paper>
							</div>
						</main>
					</div>
				)
			}
		};
}

export default withStyles(useStyles)(home);