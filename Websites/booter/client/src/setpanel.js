import React, { Component } from 'react';
import { withStyles } from '@material-ui/core/styles';
import Paper from '@material-ui/core/Paper';
import TextField from '@material-ui/core/TextField';
import Typography from '@material-ui/core/Typography';
import Breadcrumbs from '@material-ui/core/Breadcrumbs';
import Divider from '@material-ui/core/Divider';
import Settings from './settings.json';
import Button from '@material-ui/core/Button';
import SaveIcon from '@material-ui/icons/Save';
import FavoriteIcon from '@material-ui/icons/Favorite';
import DeleteForeverIcon from '@material-ui/icons/DeleteForever';
import RemoveIcon from '@material-ui/icons/Remove';
import AddIcon from '@material-ui/icons/Add';
import SendIcon from '@material-ui/icons/Send';
import Snackbar from '@material-ui/core/Snackbar';
import MuiAlert from '@material-ui/lab/Alert';
import AllInclusiveIcon from '@material-ui/icons/AllInclusive';
import Grid from '@material-ui/core/Grid';

function Alert(props) {
	return <MuiAlert elevation={6} variant="filled" {...props} />;
}

const useStyles = (theme) => ({
	root: {
	    flexGrow: 1,
	},
});

class UserPanel extends Component {
	constructor(props)
	{
		super(props);
		this.state = {
			currentPW : '',
			NewPW : '',
			ConfirmNewPW : '',
			currentEmail : '',
			NewEmail : '',
			ConfirmNewEmail : '',
			messageinfo : '',
			messageseverity : '',
			SnackbackBoolean : false
		}
	}
	HandleChange = event => {
		this.setState({
			currentPW : event.target.value
		});
	}
	HandleChange2 = event => {
		this.setState({
			NewPW : event.target.value
		});
	}
	HandleChange3 = event => {
		this.setState({
			ConfirmNewPW : event.target.value
		});
	}

	HandleChangeE = event => {
		this.setState({
			currentEmail : event.target.value
		});
	}
	HandleChange2E = event => {
		this.setState({
			NewEmail : event.target.value
		});
	}
	HandleChange3E = event => {
		this.setState({
			ConfirmNewEmail : event.target.value
		});
	}

	HandleSnackbar = (event, reason) => {
		if (reason === 'clickaway') {
			return;
		}
		this.setState({
			SnackbackBoolean : false
		})
	}

	HandleSubmit = event => {
		const {
			currentPW,
			NewPW,
			ConfirmNewPW
		} = this.state
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/settings/changepw', {
			method : 'POST',
			headers : {
				'Content-Type': 'application/json'
			},
			body : JSON.stringify({
				Token : token,
				currentPW : currentPW,
				NewPW : NewPW,
				ConfirmNewPW : ConfirmNewPW
			})
		})
		.then(res => res.json())
		.then(json => {
			if(json.success)
			{
				this.setState({
					messageinfo : json.message,
					messageseverity : 'success',
					SnackbackBoolean : true
				})
			}
			else
			{
				this.setState({
					messageinfo : json.message,
					messageseverity : 'error',
					SnackbackBoolean : true
				})
			}
		})
	}

	HandleSubmit2 = event => {
		const {
			currentEmail,
			NewEmail,
			ConfirmNewEmail
		} = this.state
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/settings/changemail', {
			method : 'POST',
			headers : {
				'Content-Type': 'application/json'
			},
			body : JSON.stringify({
				Token : token,
				currentEmail : currentEmail,
				NewEmail : NewEmail,
				ConfirmNewEmail : ConfirmNewEmail
			})
		})
		.then(res => res.json())
		.then(json => {
			if(json.success)
			{
				this.setState({
					messageinfo : json.message,
					messageseverity : 'success',
					SnackbackBoolean : true
				})
			}
			else
			{
				this.setState({
					messageinfo : json.message,
					messageseverity : 'error',
					SnackbackBoolean : true
				})
			}
		})
	}

	HandleSubmit3 = event => {
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/settings/clearlogs', {
			method : 'POST',
			headers : {
				'Content-Type': 'application/json'
			},
			body : JSON.stringify({
				Token : token
			})
		})
		.then(res => res.json())
		.then(json => {
			if(json.success)
			{
				this.setState({
					messageinfo : json.message,
					messageseverity : 'success',
					SnackbackBoolean : true
				})
			}
			else
			{
				this.setState({
					messageinfo : json.message,
					messageseverity : 'error',
					SnackbackBoolean : true
				})
			}
		})
	}

	render () {
		const {
			currentPW,
			NewPW,
			ConfirmNewPW,
			currentEmail,
			NewEmail,
			ConfirmNewEmail,
			messageinfo,
			messageseverity,
			SnackbackBoolean
		} = this.state;
		const { classes }  = this.props;
		return (
			<div>
				<Snackbar open={SnackbackBoolean} autoHideDuration={6000} onClose={this.HandleSnackbar}>
					<Alert onClose={this.HandleSnackbar} severity={messageseverity}>
						{messageinfo}
					</Alert>
				</Snackbar>
				<div 
					style={{ 
						marginBottom: '1rem'
					}}
				>
					<Breadcrumbs aria-label="breadcrumb">
						<Typography color="inherit">Home</Typography>
						<Typography color="textPrimary">Settings</Typography>
					</Breadcrumbs>
				</div>
				<Divider />
				<div
					className={classes.root} 
					style={{
						marginBottom: '1rem',
						marginTop: '1rem'
					}}
				>
					<Grid container spacing={3}>
						<Grid
							item
							sm={6}
							xs={12}
				        >
							<Paper
								style={{
									padding: '1rem',
								}}
							>
								<div
									style={{
										marginBottom: '1rem',
										textAlign: 'center'
									}}
								>
									<Typography variant="h6" gutterBottom>
											Change Password
									</Typography>
								</div>
								<div
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<TextField 
										label="Current Password"
										type="password" 
										variant="filled"
										value={currentPW}
										onChange={this.HandleChange}
										style={{
											width: '100%'
										}}
									/>
								</div>
								<div
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<TextField 
										label="New Password" 
										type="password" 
										variant="filled"
										value={NewPW}
										onChange={this.HandleChange2}
										style={{
											width: '100%'
										}}
									/>
								</div>
								<div
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<TextField 
										label="Confirm New Password" 
										type="password" 
										variant="filled"
										value={ConfirmNewPW}
										onChange={this.HandleChange3}
										style={{
											width: '100%'
										}}
									/>
								</div>
													<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<SaveIcon />}
										style={{
											width: '100%'
										}}
										onClick={this.HandleSubmit}
									>
										Update Password
									</Button>
								</div>
							</Paper>
						</Grid>
						<Grid
							item
							sm={6}
							xs={12}
				        >
							<Paper
								style={{
									padding: '1rem',
								}}
							>
								<div
									style={{
										marginBottom: '1rem',
										textAlign: 'center'
									}}
								>
									<Typography variant="h6" gutterBottom>
											Change Email
									</Typography>
								</div>
								<div
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<TextField 
										label="Current Email"
										variant="filled"
										value={currentEmail}
										onChange={this.HandleChangeE}
										style={{
											width: '100%'
										}}
									/>
								</div>
								<div
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<TextField 
										label="New Email" 
										variant="filled"
										value={NewEmail}
										onChange={this.HandleChange2E}
										style={{
											width: '100%'
										}}
									/>
								</div>
								<div
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<TextField 
										label="Confirm New Email" 
										variant="filled"
										value={ConfirmNewEmail}
										onChange={this.HandleChange3E}
										style={{
											width: '100%'
										}}
									/>
								</div>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<SaveIcon />}
										style={{
											width: '100%'
										}}
										onClick={this.HandleSubmit2}
									>
										Update Email
									</Button>
								</div>
							</Paper>
						</Grid>
						<Grid
							item
							xs={12}
				        >
							<Paper
								style={{
									padding: '1rem',
								}}
							>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<AddIcon />}
										style={{
											width: '100%'
										}}
									>
										Add Balance
									</Button>
								</div>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<SendIcon />}
										style={{
											width: '100%'
										}}
									>
										Send Money
									</Button>
								</div>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<AllInclusiveIcon />}
										style={{
											width: '100%'
										}}
									>
										Upgrade Account
									</Button>
								</div>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<FavoriteIcon />}
										style={{
											width: '100%'
										}}
									>
										Support Us
									</Button>
								</div>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<RemoveIcon />}
										style={{
											width: '100%'
										}}
										onClick={this.HandleSubmit3}
									>
										Purge all Logs
									</Button>
								</div>
								<div	
									style={{
										marginBottom: '1rem',
										width: '100%'
									}}
								>
									<Button
										variant="contained"
										endIcon={<DeleteForeverIcon />}
										style={{
											width: '100%'
										}}
									>
										Delete Account
									</Button>
								</div>
							</Paper>
						</Grid>
					</Grid>
				</div>
			</div>
		)
	};
}

export default withStyles(useStyles)(UserPanel);