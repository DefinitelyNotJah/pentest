import React, { Component, Fragment } from 'react';
import { withStyles } from '@material-ui/core/styles';
import Paper from '@material-ui/core/Paper';
import Table from '@material-ui/core/Table';
import TableBody from '@material-ui/core/TableBody';
import TableCell from '@material-ui/core/TableCell';
import TableHead from '@material-ui/core/TableHead';
import TableRow from '@material-ui/core/TableRow';
import Typography from '@material-ui/core/Typography';
import Breadcrumbs from '@material-ui/core/Breadcrumbs';
import Divider from '@material-ui/core/Divider';
import Grid from '@material-ui/core/Grid';
import Settings from './settings.json';
import Button from '@material-ui/core/Button';
import Collapse from '@material-ui/core/Collapse';
import KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown';
import KeyboardArrowUpIcon from '@material-ui/icons/KeyboardArrowUp';
import IconButton from '@material-ui/core/IconButton';
import Box from '@material-ui/core/Box';

const useStyles = (theme) => ({
	paperX1: {
		overflowX: 'auto',
		height: theme.spacing(50),
		width: '100%',
	},
	table: {
		minWidth: 650,
		maxWidth: '100%',
	},
	styleButton: {
		width: theme.spacing(20),
		marginLeft: '1rem',
	},
	root: {
		'& > *': {
			borderBottom: 'unset',
		},
	},
});

class ManageServers extends Component {
	constructor(props)
	{
		super(props);
		this.state = {
			ServerInfo: [],
			open : false
		}
	}
	OpenDragger = (event) => 
	{
		const {
			open 
		} = this.state;
		this.setState({
			open : !open
		})
	}
	componentDidMount()
	{
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/manageservers?token=' + token)
		.then(res => res.json())
		.then(json => {
			console.log(json)
			if(json.success)
			{
				this.setState({
					ServerInfo : json.ServerInfo
				});
			}
		});
	}
	render () {
		const {
			ServerInfo,
			open
		} = this.state;
		const { classes }  = this.props;
		return (
			<div>
				<div 
					style={{ 
						marginBottom: '1rem'
					}}
				>
					<Breadcrumbs aria-label="breadcrumb">
						<Typography color="inherit">Home</Typography>
						<Typography color="textPrimary">Manage Servers</Typography>
					</Breadcrumbs>
				</div>
				<Divider />
				<div
					style={{
						marginBottom: '1rem'
					}}
				>
					<Paper
						className={classes.paperX1}
					>
						<Grid item xs={12}>
							<Table className={classes.table}>
								<TableHead>
									<TableRow>
										<TableCell align="left"/>
										<TableCell align="left">Server Name</TableCell>
										<TableCell align="right">Layer 4</TableCell>
										<TableCell align="right">Expires in</TableCell>
										<TableCell align="right">Action</TableCell>
									</TableRow>
								</TableHead>
								<TableBody>
									{ServerInfo.map((option, index) => (
									<Fragment>
										<TableRow key={index} className={classes.root}>
											<TableCell align="left">
												<IconButton size="small" onClick={this.OpenDragger}>
													{open ? <KeyboardArrowUpIcon /> : <KeyboardArrowDownIcon />}
												</IconButton>
											</TableCell>
											<TableCell component="th" scope="row" align="left">
												{option.ServName}
											</TableCell>
											<TableCell align="right">{option.L4 ? 'Yes' : 'No' }</TableCell>
											<TableCell align="right">{option.Expire}</TableCell>
											<TableCell align="right">
												<Button className={classes.styleButton} variant="contained" color="primary">
													Renew
												</Button>
											</TableCell>
										</TableRow>
										<TableRow>
											<TableCell style={{ paddingBottom: 0, paddingTop: 0 }} colSpan={6}>
												<Collapse in={open} timeout="auto" unmountOnExit>
													<Box margin={1}>
												        <Typography variant="subtitle-1" gutterBottom component="div">
										                	RAM count : {option.RAM} gigabytes
										                </Typography>
										                <Typography variant="subtitle-1" gutterBottom component="div">
										                	Cores count : {option.CORES} 
										                </Typography>
										                <Typography variant="subtitle-1" gutterBottom component="div">
										                	Shared : {option.SHARE ? 'Yes' : 'No'} 
										                </Typography>
										                <Typography variant="subtitle-1" gutterBottom component="div">
										                	Estimated Layer 7 Power : {option.MINREQ}k r/s
										                </Typography>
										                <Typography variant="subtitle-1" gutterBottom component="div">
										                	Estimated Layer 4 Power : {option.MINPW}GBPS
										                </Typography>
													</Box>
												</Collapse>
											</TableCell>
										</TableRow>
									</Fragment>
									))}
								</TableBody>
							</Table>
						</Grid>
					</Paper>
				</div>
				<div
					style={{
						marginRight: '1rem',
						height: '100%',
						width: '100%',
						display: 'flex',
						justifyContent: 'flex-end'
					}}
				>
					<Button className={classes.styleButton} variant="contained" color="primary">
						Purchase
					</Button>
				</div>
			</div>
		)
	};
}

export default withStyles(useStyles)(ManageServers);