import React, { Component } from 'react';
import { withStyles } from '@material-ui/core/styles';
import Paper from '@material-ui/core/Paper';
import Typography from '@material-ui/core/Typography';
import Breadcrumbs from '@material-ui/core/Breadcrumbs';
import Divider from '@material-ui/core/Divider';
import TextField from '@material-ui/core/TextField';
import Button from '@material-ui/core/Button';
import SearchIcon from '@material-ui/icons/Search';
import List from '@material-ui/core/List';
import ListItem from '@material-ui/core/ListItem';
import ListItemText from '@material-ui/core/ListItemText';
import Settings from './settings.json';
import 'whatwg-fetch';

const useStyles = (theme) => ({
	root: {
	    display: 'flex',
	    flexWrap: 'wrap',
	},
	CommonPorts: {
		width: 200,
		height: 230,
		overflow: 'auto',
		marginLeft: '1rem',
		marginRight: '1rem'
	},
	PaperX1: {
		margin: theme.spacing(1),
		width: theme.spacing(50),
		height: theme.spacing(30),
	},
	PaperX2: {
		margin: theme.spacing(1),
		width: theme.spacing(120),
		height: 'auto',
	},
});

class WhoSearch extends Component {

	constructor(props)
	{
		super(props);
		this.state = {
			HostnameTarget : '',
			ScanResult : false,
			openports : []
		}
	}

	HandleChange = (event) => {
		this.setState({
			HostnameTarget : event.target.value
		});
	}
	HandleSubmit = (event) => {
		const {
			HostnameTarget
		} = this.state;
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/tools/portscan', {
			method : 'POST',
			headers : {
				'Content-Type': 'application/json'
			},
			body : JSON.stringify({
				Token : token,
				HostnameTarget : HostnameTarget
			})
		})
		.then(res => res.json())
		.then(json => {
			if(json.success)
			{
				this.setState({
					ScanResult : true,
					openports : json.openports
				});
			}
		})
	}
	render () {
		const {
			HostnameTarget,
			ScanResult,
			openports
		} = this.state;
		const { classes }  = this.props;
		return (
			<div>
				<div 
					style={{ 
						marginBottom: '1rem'
					}}
				>
					<Breadcrumbs aria-label="breadcrumb">
						<Typography color="inherit">Home</Typography>
						<Typography color="inherit">Tools</Typography>
						<Typography color="textPrimary">Portscan</Typography>
					</Breadcrumbs>
				</div>
				<Divider />
				<div 
					className={classes.root} 	
					style={{ 
						marginTop: '1rem',
						marginBottom: '1rem'
					}}
				>
					<Paper
						className={classes.PaperX1}
						style={{
							padding: '1rem',
						}}
					>
						<div
							style={{
								marginBottom: '1rem',
								textAlign: 'center'
							}}
						>
							<Typography variant="h6" gutterBottom>
								Input
							</Typography>
							<div
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<TextField 
									label="IPv4 address" 
									variant="filled"
									value={HostnameTarget}
									onChange={this.HandleChange}
									helperText="Example : 192.168.255.255"
									style={{
										width: '100%'
									}}
								/>
							</div>
							<div	
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<Button
									variant="contained"
									endIcon={<SearchIcon />}
									style={{
										width: '100%'
									}}
									onClick={this.HandleSubmit}
								>
									Scan
								</Button>
							</div>
						</div>
					</Paper>
					{
						ScanResult ? 
						(
							<Paper
								className={classes.PaperX2}
								style={{
									padding: '1rem',
								}}
							>
								<div
									style={{
										marginBottom: '1rem'
									}}
								>
									<Typography variant="h6" gutterBottom>
										Result
									</Typography>
								</div>
								<div>
									<Typography variant="subtitle1" gutterBottom>
										Open Ports :
							      	</Typography>
									{
										openports.map( (result) => (
											<Typography variant="subtitle1" gutterBottom>
												{result}
									      	</Typography>
										))
									}
								</div>
							</Paper>
						) : null
					}
				</div>
				<Divider />
				<div>
					<div
						style={{
							marginBottom: '1rem',
							marginTop: '1rem'
						}}
					>
						<Typography variant="h6" gutterBottom>
							Common TCP Ports :
						</Typography>
						<div className={classes.root}>
							<Paper className={classes.CommonPorts}>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='21 - FTP' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='22 - SSH' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='23 - Telnet' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='25 - SMTP' />
									</ListItem>
								</List>
							</Paper>
							<Paper className={classes.CommonPorts}>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='53 - DNS' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='67 - DHCP' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='68 - DHCP' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='69 - TFTP' />
									</ListItem>
								</List>
							</Paper>
							<Paper className={classes.CommonPorts}>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='80 - HTTP' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='110 - IMAP' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='443 - HTTPS' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='445 - SMB' />
									</ListItem>
								</List>
							</Paper>
							<Paper className={classes.CommonPorts}>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='546 - DHCP Client' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='547 - DHCP Server' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='563 - SNEWS' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='1080 - Socks' />
									</ListItem>
								</List>
							</Paper>
							<Paper className={classes.CommonPorts}>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='2082 - cPanel' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='2086 - WHM' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='3306 - MySQL' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='3389 - WBT' />
									</ListItem>
								</List>
							</Paper>
							<Paper className={classes.CommonPorts}>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='5900 - VNC' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='8080 - HTTP Proxy' />
									</ListItem>
								</List>
								<List dense component="div" role="list">
									<ListItem button role="listitem">
										<ListItemText primary='27017 - MongoDB' />
									</ListItem>
								</List>
							</Paper>
						</div>
					</div>
				</div>
			</div>
		)
	};
}

export default withStyles(useStyles)(WhoSearch);