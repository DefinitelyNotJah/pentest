import React, { Component } from 'react';
import { withStyles } from '@material-ui/core/styles';
import Paper from '@material-ui/core/Paper';
import Typography from '@material-ui/core/Typography';
import Breadcrumbs from '@material-ui/core/Breadcrumbs';
import Divider from '@material-ui/core/Divider';
import TextField from '@material-ui/core/TextField';
import Button from '@material-ui/core/Button';
import SearchIcon from '@material-ui/icons/Search';
import MenuItem from '@material-ui/core/MenuItem';
import Settings from './settings.json';
import 'whatwg-fetch';

const AvailableGames = [
	{
		name: 'Arma 3',
		value: 'arma3'
	},
	{
		name: 'Call of Duty : Modern Warefare 2',
		value: 'codmw2'
	},
	{
		name: 'Counter Strike 1.6',
		value: 'cs16'
	},
	{
		name: 'Counter-Strike: Global Offensive',
		value: 'csgo'
	},
	{
		name: 'Counter-Strike: Source',
		value: 'css'
	},
	{
		name: 'Crysis 2',
		value: 'crysis2'
	},
	{
		name: 'Day of Defeat',
		value: 'dod'
	},
	{
		name: 'Day of Defeat: Source',
		value: 'dods'
	},
	{
		name: 'DayZ',
		value: 'dayz'
	},
	{
		name: 'Dota 2',
		value: 'dota2'
	},
	{
		name: 'Far Cry 2',
		value: 'farcry2'
	},
	{
		name: 'Garry Mod',
		value: 'garrysmod'
	},
	{
		name: 'Grand Theft Auto V',
		value: 'fivem'
	},
	{
		name: 'Grand Theft Auto: San Andreas - Multi Theft Auto',
		value: 'mtasa'
	},
	{
		name: 'Half-Life 2: Deathmatch',
		value: 'hl2dm'
	},
	{
		name: 'Half-Life Deathmatch',
		value: 'hldm'
	},
	{
		name: 'Half-Life Deathmatch: Source',
		value: 'hldms'
	},
	{
		name: 'Left 4 Dead',
		value: 'left4dead'
	},
	{
		name: 'Left 4 Dead 2',
		value: 'left4dead2'
	},
	{
		name: 'Minecraft',
		value: 'minecraft'
	},
	{
		name: 'San Andreas Multiplayer',
		value: 'samp'
	},
	{
		name: 'Rust',
		value: 'rust'
	},
	{
		name: 'Team Fortress 2',
		value: 'tf2'
	},	
	{
		name: 'Team Fortress Classic',
		value: 'tfc'
	},
	{
		name: 'Teamspeak 2',
		value: 'teamspeak2'
	},	
	{
		name: 'Teamspeak 3',
		value: 'teamspeak3'
	},
];
const useStyles = (theme) => ({
	root: {
	    display: 'flex',
	    flexWrap: 'wrap',
	},
	PaperX1: {
		margin: theme.spacing(1),
		width: theme.spacing(50),
		height: theme.spacing(60),
	},
	PaperX2: {
		margin: theme.spacing(1),
		width: theme.spacing(120),
		height: theme.spacing(60),
	},
});

class GameServerQuery extends Component {

	constructor(props)
	{
		super(props);
		this.state = {
			HostnameTarget : '',
			ScanResult : false,
			GameValue : '',
			PortChosen : 0,
			name : '',
			map: '',
			game: '',
			maxplayers : 0,
			onlinebots : 0,
			onlineplayers : 0
		}
	}

	HandleChange = (event) => {
		this.setState({
			HostnameTarget : event.target.value
		});
	}
	HandleChange2 = (event) => {
		this.setState({
			GameValue : event.target.value
		});
	}
	HandleChange3 = (event) => {
		this.setState({
			PortChosen : event.target.value
		});
	}
	HandleSubmit = (event) => {
		const {
			HostnameTarget,
			GameValue,
			PortChosen
		} = this.state;
		var token = this.props.token;
		fetch(Settings.BACKEND_SERVER + 'app/api/tools/gameserverquery', {
			method : 'POST',
			headers : {
				'Content-Type': 'application/json'
			},
			body : JSON.stringify({
				Token : token,
				HostnameTarget : HostnameTarget,
				GameValue : GameValue,
				PortChosen : PortChosen
			})
		})
		.then(res => res.json())
		.then(json => {
			if(json.success)
			{
				this.setState({
					ScanResult : true,
					name : json.name,
					map : json.map,
					game : json.game,
					maxplayers : json.maxplayers,
					onlinebots : json.onlinebots,
					onlineplayers : json.onlineplayers
				});
			}
		})
	}
	render () {
		const {
			HostnameTarget,
			ScanResult,
			GameValue,
			PortChosen,
			name,
			map,
			game,
			maxplayers,
			onlinebots,
			onlineplayers
		} = this.state;
		const { classes }  = this.props;
		return (
			<div>
				<div 
					style={{ 
						marginBottom: '1rem'
					}}
				>
					<Breadcrumbs aria-label="breadcrumb">
						<Typography color="inherit">Home</Typography>
						<Typography color="inherit">Tools</Typography>
						<Typography color="textPrimary">Game Server Query</Typography>
					</Breadcrumbs>
				</div>
				<Divider />
				<div 
					className={classes.root} 	
					style={{ 
						marginTop: '1rem',
						marginBottom: '1rem'
					}}
				>
					<Paper
						className={classes.PaperX1}
						style={{
							padding: '1rem',
						}}
					>
						<div
							style={{
								marginBottom: '1rem',
								textAlign: 'center'
							}}
						>
							<Typography variant="h6" gutterBottom>
								Input
							</Typography>
							<div
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<TextField 
									label="IP/Hostname" 
									variant="filled"
									value={HostnameTarget}
									onChange={this.HandleChange}
									helperText="Example : mc.hypixel.net"
									style={{
										width: '100%'
									}}
								/>
							</div>
							<div
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<TextField 
									label="Port"
									type="number"
									value={PortChosen}
									onChange={this.HandleChange3}
									InputLabelProps={{
										shrink: true,
									}}
									variant="filled"
									helperText="Example : 25565"
									style={{
										width: '100%'
									}}
								/>
							</div>
							<div
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<TextField 
										select
										label="Game"
										value={GameValue}
										variant="filled"
										onChange={this.HandleChange2}
										helperText="Example : Minecraft"
										style={{
											width: '100%'
										}}
									>
									{AvailableGames.map((option) => (
										<MenuItem key={option} value={option.value}>
											{option.name}
										</MenuItem>
									))}
								</TextField>
							</div>
							<div	
								style={{
									marginBottom: '1rem',
									width: '100%'
								}}
							>
								<Button
									variant="contained"
									endIcon={<SearchIcon />}
									style={{
										width: '100%'
									}}
									onClick={this.HandleSubmit}
								>
									Scan
								</Button>
							</div>
						</div>
					</Paper>
					{
						ScanResult ? 
						(
							<Paper
								className={classes.PaperX2}
								style={{
									padding: '1rem'
								}}
							>
								<div
									style={{
										marginBottom: '1rem'
									}}
								>
									<Typography variant="h6" gutterBottom>
										Result
									</Typography>
								</div>
								<div>
									<Typography variant="subtitle1" gutterBottom>
										Server Name : {name}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Current Map : {map}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Game : {game}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Maximum Players : {maxplayers}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Online Bots : {onlinebots}
							      	</Typography>
							      	<Typography variant="subtitle1" gutterBottom>
										Online Players : {onlineplayers}
							      	</Typography>
								</div>
							</Paper>
						) : null
					}
				</div>
			</div>
		)
	};
}

export default withStyles(useStyles)(GameServerQuery);