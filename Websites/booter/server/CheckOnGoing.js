const UserSchema = require('./UserSchema');
const DirectorySchema = require('./DirectorySchema')

function CheckOnGoing(user_id)
{
	return new Promise( (resolve, reject) => {
		UserSchema.findOne({
			userID : user_id
		}).then( (doc) => {
			const YeahAss = doc.AssignedDirbusters
			const Searching = new Promise( (resolveX, rejectX) => {
				YeahAss.forEach( (dirbusted, index, array) => {
					DirectorySchema.findOne({
						ID : dirbusted
					}).then( (results) => {
						if(results !== null)
						{
							if(!results.Status)
								resolve(false)
						}
						if (index === array.length -1){
							resolveX()
						}
					})
					
				})
			})
			Searching.then( () => {
				return resolve(true)
			})
			.catch( (err) => {
				return resolve(false)
			})
		}).catch( (err) => {
			return resolve(false)
		})
	})
}
module.exports = {
	CheckOnGoing
};