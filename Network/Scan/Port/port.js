const net = require('net');
const scan = require('./utils/scan');
const ports = require('./ports.json')

if (process.argv.length <= 3) {
	console.log("Usage: node port.js <destination> <start_port> <end_port>");
	console.log("Usage: node port.js <192.168.1.1> <1> <10000> // scans for 1-10000 ports");
	process.exit(-1);
}
var destination = process.argv[2];
var portStart = process.argv[3];
var portEnd = process.argv[4];
console.log(`Scanning host ${destination} for ports in range ${portStart}-${portEnd}`)
scan.port({
	host: destination,
	start: portStart,
	end: portEnd,
	timeout: 5000
}, (err, result) => {  
	if(err)
		return console.log(`An error happened during the scan : ${err.message}`)
    let fields = []
    result.forEach( (e) => {
		if(
			typeof ports != 'undefined' &&
			typeof ports.ports != 'undefined' &&
			typeof ports.ports[`${e}`] != 'undefined' &&
			typeof ports.ports[`${e}`].description != 'undefined'
		) {
			fields.push({
				name : e,
				value : ports.ports[`${e}`].description
			})
		}
		else if(
			typeof ports != 'undefined' &&
			typeof ports.ports != 'undefined' &&
			typeof ports.ports[`${e}`] != 'undefined' &&
			typeof ports.ports[`${e}`][0] != 'undefined' &&
			typeof ports.ports[`${e}`][0].description != 'undefined'
		) {
			fields.push({
				name : e,
				value : ports.ports[`${e}`][0].description
			})
		}
		else {
			fields.push({
				name : e,
				value : 'Unknown'
			})
		}
	})
    fields.forEach( (element) => {
    	console.log(`PORT ${element.name} ${element.value}`)
    })
})